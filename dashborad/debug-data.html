<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Debug Tool - Soulix Tech</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .data-box {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .stat {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            font-weight: bold;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        .status {
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            font-weight: bold;
        }
        .status.pending { background: #ffc107; color: #000; }
        .status.approved { background: #28a745; color: white; }
        .status.rejected { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Data Debug Tool</h1>
        
        <div class="section">
            <h2>üìä Quick Stats</h2>
            <div id="stats"></div>
        </div>
        
        <div class="section">
            <h2>üíæ LocalStorage Data</h2>
            <div id="localStorageData" class="data-box"></div>
            <button onclick="viewLocalStorage()">üîÑ Refresh LocalStorage</button>
            <button class="danger" onclick="clearLocalStorage()">üóëÔ∏è Clear LocalStorage</button>
        </div>
        
        <div class="section">
            <h2>‚òÅÔ∏è Supabase Applications Table</h2>
            <div id="supabaseData" class="data-box"></div>
            <button onclick="viewSupabase()">üîÑ Refresh Supabase</button>
            <button onclick="viewSupabaseSeparate()">üìã View By Table</button>
        </div>
        
        <div class="section">
            <h2>üî• Actions</h2>
            <button onclick="compareData()">‚öñÔ∏è Compare LocalStorage vs Supabase</button>
            <button onclick="migrateToSupabase()">üöÄ Migrate All to Supabase</button>
            <button onclick="syncFromSupabase()">üì• Sync From Supabase</button>
        </div>
        
        <div id="results" class="section" style="display:none;">
            <h2>üìã Results</h2>
            <div id="resultsContent" class="data-box"></div>
        </div>
    </div>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        const SUPABASE_URL = 'https://xmtxeagxnqfczenqwizz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtdHhlYWd4bnFmY3plbnF3aXp6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0Mzg3MTgsImV4cCI6MjA3ODAxNDcxOH0.NUTpXhNfoXkcCrWhGE2-j4V6p9VydN6EkLPUCBVqeh8';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        function showResults(content) {
            document.getElementById('results').style.display = 'block';
            document.getElementById('resultsContent').innerHTML = content;
        }
        
        function viewLocalStorage() {
            const data = localStorage.getItem('soulixApplications');
            if (!data) {
                document.getElementById('localStorageData').innerHTML = '‚ùå No data found';
                return;
            }
            
            const applications = JSON.parse(data);
            const pending = applications.filter(app => app.status === 'Pending');
            const approved = applications.filter(app => app.status === 'Approved');
            const rejected = applications.filter(app => app.status === 'Rejected');
            
            let html = `
                <strong>Total Applications: ${applications.length}</strong><br>
                <span class="status pending">Pending: ${pending.length}</span>
                <span class="status approved">Approved: ${approved.length}</span>
                <span class="status rejected">Rejected: ${rejected.length}</span>
                <hr style="margin: 15px 0;">
                <pre>${JSON.stringify(applications, null, 2)}</pre>
            `;
            
            document.getElementById('localStorageData').innerHTML = html;
            updateStats();
        }
        
        async function viewSupabase() {
            try {
                const { data, error } = await supabase
                    .from('applications')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const pending = data.filter(app => app.status === 'Pending');
                const approved = data.filter(app => app.status === 'Approved');
                const rejected = data.filter(app => app.status === 'Rejected');
                
                let html = `
                    <strong>Total in Supabase: ${data.length}</strong><br>
                    <span class="status pending">Pending: ${pending.length}</span>
                    <span class="status approved">Approved: ${approved.length}</span>
                    <span class="status rejected">Rejected: ${rejected.length}</span>
                    <hr style="margin: 15px 0;">
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                document.getElementById('supabaseData').innerHTML = html;
            } catch (error) {
                document.getElementById('supabaseData').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        async function viewSupabaseSeparate() {
            try {
                const { data: mainData } = await supabase.from('applications').select('*');
                const { data: approvedData } = await supabase.from('approved_applications').select('*');
                const { data: rejectedData } = await supabase.from('rejected_applications').select('*');
                const { data: pendingData } = await supabase.from('pending_applications').select('*');
                
                let html = `
                    <strong>Data Distribution Across Tables:</strong><br><br>
                    
                    <strong>applications table:</strong> ${mainData?.length || 0} records<br>
                    <pre>${JSON.stringify(mainData || [], null, 2)}</pre>
                    <hr style="margin: 15px 0;">
                    
                    <strong>approved_applications table:</strong> ${approvedData?.length || 0} records<br>
                    <pre>${JSON.stringify(approvedData || [], null, 2)}</pre>
                    <hr style="margin: 15px 0;">
                    
                    <strong>rejected_applications table:</strong> ${rejectedData?.length || 0} records<br>
                    <pre>${JSON.stringify(rejectedData || [], null, 2)}</pre>
                    <hr style="margin: 15px 0;">
                    
                    <strong>pending_applications table:</strong> ${pendingData?.length || 0} records<br>
                    <pre>${JSON.stringify(pendingData || [], null, 2)}</pre>
                `;
                
                showResults(html);
            } catch (error) {
                showResults(`‚ùå Error: ${error.message}`);
            }
        }
        
        async function compareData() {
            const localData = JSON.parse(localStorage.getItem('soulixApplications') || '[]');
            const { data: supabaseData } = await supabase.from('applications').select('*');
            
            const localPending = localData.filter(app => app.status === 'Pending').length;
            const localApproved = localData.filter(app => app.status === 'Approved').length;
            const localRejected = localData.filter(app => app.status === 'Rejected').length;
            
            const supabasePending = supabaseData?.filter(app => app.status === 'Pending').length || 0;
            const supabaseApproved = supabaseData?.filter(app => app.status === 'Approved').length || 0;
            const supabaseRejected = supabaseData?.filter(app => app.status === 'Rejected').length || 0;
            
            let html = `
                <h3>üìä Comparison</h3>
                <table style="width:100%; border-collapse: collapse;">
                    <tr style="background: #f0f0f0;">
                        <th style="padding: 10px; border: 1px solid #ddd;">Status</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">LocalStorage</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">Supabase</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">Difference</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">Pending</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${localPending}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${supabasePending}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${localPending - supabasePending}</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">Approved</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${localApproved}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${supabaseApproved}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${localApproved - supabaseApproved}</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">Rejected</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${localRejected}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${supabaseRejected}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${localRejected - supabaseRejected}</td>
                    </tr>
                    <tr style="background: #f0f0f0; font-weight: bold;">
                        <td style="padding: 10px; border: 1px solid #ddd;">TOTAL</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${localData.length}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${supabaseData?.length || 0}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${localData.length - (supabaseData?.length || 0)}</td>
                    </tr>
                </table>
            `;
            
            showResults(html);
        }
        
        async function migrateToSupabase() {
            if (!confirm('‚ö†Ô∏è This will migrate ALL localStorage data to Supabase. Continue?')) {
                return;
            }
            
            const localData = JSON.parse(localStorage.getItem('soulixApplications') || '[]');
            let success = 0;
            let failed = 0;
            
            for (const app of localData) {
                try {
                    const supabaseApp = {
                        id: app.id,
                        name: app.name,
                        email: app.email,
                        phone: app.phone,
                        course: app.course,
                        status: app.status,
                        applied_date: app.appliedDate,
                        approved_date: app.approvedDate || null,
                        rejected_date: app.rejectedDate || null,
                        payment_type: app.paymentType || null,
                        payment_amount: app.paymentAmount || null,
                        payment_status: app.paymentStatus || null,
                        upi_transaction_id: app.upiTransactionId || null,
                        rejection_reason: app.rejectionReason || null,
                        approved_by: app.approvedBy ? JSON.stringify(app.approvedBy) : null,
                        rejected_by: app.rejectedBy ? JSON.stringify(app.rejectedBy) : null
                    };
                    
                    const { error } = await supabase
                        .from('applications')
                        .upsert([supabaseApp], { onConflict: 'id' });
                    
                    if (error) throw error;
                    success++;
                } catch (error) {
                    console.error('Failed to migrate:', app.id, error);
                    failed++;
                }
            }
            
            showResults(`
                <h3>‚úÖ Migration Complete</h3>
                <p><strong>Success:</strong> ${success} applications</p>
                <p><strong>Failed:</strong> ${failed} applications</p>
                <button onclick="viewSupabase()">View Migrated Data</button>
            `);
        }
        
        async function syncFromSupabase() {
            if (!confirm('‚ö†Ô∏è This will replace localStorage with Supabase data. Continue?')) {
                return;
            }
            
            const { data, error } = await supabase.from('applications').select('*');
            
            if (error) {
                showResults(`‚ùå Error: ${error.message}`);
                return;
            }
            
            const localApps = data.map(app => ({
                id: app.id, name: app.name, email: app.email, phone: app.phone,
                course: app.course, status: app.status, appliedDate: app.applied_date,
                approvedDate: app.approved_date, rejectedDate: app.rejected_date,
                paymentType: app.payment_type, paymentAmount: app.payment_amount,
                paymentStatus: app.payment_status, upiTransactionId: app.upi_transaction_id,
                rejectionReason: app.rejection_reason,
                approvedBy: app.approved_by ? JSON.parse(app.approved_by) : null,
                rejectedBy: app.rejected_by ? JSON.parse(app.rejected_by) : null
            }));
            
            localStorage.setItem('soulixApplications', JSON.stringify(localApps));
            
            showResults(`
                <h3>‚úÖ Sync Complete</h3>
                <p>Synced ${localApps.length} applications from Supabase to LocalStorage</p>
                <button onclick="viewLocalStorage()">View LocalStorage</button>
            `);
        }
        
        function clearLocalStorage() {
            if (confirm('‚ö†Ô∏è This will DELETE all localStorage data! Are you sure?')) {
                localStorage.removeItem('soulixApplications');
                document.getElementById('localStorageData').innerHTML = '‚úÖ LocalStorage cleared';
                updateStats();
            }
        }
        
        function updateStats() {
            const data = localStorage.getItem('soulixApplications');
            if (!data) {
                document.getElementById('stats').innerHTML = '<div class="stat">No data in LocalStorage</div>';
                return;
            }
            
            const applications = JSON.parse(data);
            const pending = applications.filter(app => app.status === 'Pending').length;
            const approved = applications.filter(app => app.status === 'Approved').length;
            const rejected = applications.filter(app => app.status === 'Rejected').length;
            
            document.getElementById('stats').innerHTML = `
                <div class="stat">Total: ${applications.length}</div>
                <div class="stat" style="background: #ffc107; color: #000;">Pending: ${pending}</div>
                <div class="stat" style="background: #28a745;">Approved: ${approved}</div>
                <div class="stat" style="background: #dc3545;">Rejected: ${rejected}</div>
            `;
        }
        
        // Auto-load on page load
        window.addEventListener('load', () => {
            viewLocalStorage();
            viewSupabase();
        });
    </script>
</body>
</html>
